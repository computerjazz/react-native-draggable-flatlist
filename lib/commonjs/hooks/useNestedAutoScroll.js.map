{"version":3,"names":["useNestedAutoScroll","params","useSafeNestableScrollContainerContext","outerScrollOffset","containerSize","scrollableRef","scrollViewSize","DUMMY_VAL","useSharedValue","hoverOffset","activeCellSize","autoscrollSpeed","autoscrollThreshold","isDraggingCell","isTouchActiveNative","hoverScreenOffset","useDerivedValue","value","isScrolledUp","SCROLL_POSITION_TOLERANCE","isScrolledDown","distToTopEdge","Math","max","distToBottomEdge","dist","isAtTopEdge","isAtBottomEdge","scrollTarget","useAnimatedReaction","cur","prev","scrollToInternal","y","current","scrollTo","animated","isAtEdge","topDisabled","bottomDisabled","isEdgeDisabled","scrollTargetDiff","abs","scrollInProgress","shouldScroll","distFromEdge","speedPct","offset","targetOffset","runOnJS"],"sources":["useNestedAutoScroll.tsx"],"sourcesContent":["import Animated, {\n  runOnJS,\n  useAnimatedReaction,\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { State as GestureState } from \"react-native-gesture-handler\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { SCROLL_POSITION_TOLERANCE } from \"../constants\";\n\n// This is mostly copied over from the main react-native-draggable-flatlist\n// useAutoScroll hook with a few notable exceptions:\n// - Since animated values are now coming in via a callback,\n//   we won't guarantee they exist (and default them if not).\n// - Outer scrollable is a ScrollView, not a FlatList\n// TODO: see if we can combine into a single shared `useAutoScroll()` hook\n\nexport function useNestedAutoScroll(params: {\n  activeCellSize?: Animated.SharedValue<number>;\n  autoscrollSpeed?: number;\n  autoscrollThreshold?: number;\n  hoverOffset?: Animated.SharedValue<number>;\n  isDraggingCell?: Animated.SharedValue<number>;\n  isTouchActiveNative?: Animated.SharedValue<number>;\n  panGestureState?: Animated.SharedValue<GestureState | number>;\n}) {\n  const {\n    outerScrollOffset,\n    containerSize,\n    scrollableRef,\n    scrollViewSize,\n  } = useSafeNestableScrollContainerContext();\n\n  const DUMMY_VAL = useSharedValue(0);\n\n  const {\n    hoverOffset = DUMMY_VAL,\n    activeCellSize = DUMMY_VAL,\n    autoscrollSpeed = 100,\n    autoscrollThreshold = 30,\n    isDraggingCell = DUMMY_VAL,\n    isTouchActiveNative = DUMMY_VAL,\n  } = params;\n\n  const hoverScreenOffset = useDerivedValue(() => {\n    return hoverOffset.value - outerScrollOffset.value;\n  }, []);\n\n  const isScrolledUp = useDerivedValue(() => {\n    return outerScrollOffset.value - SCROLL_POSITION_TOLERANCE <= 0;\n  }, []);\n\n  const isScrolledDown = useDerivedValue(() => {\n    return (\n      outerScrollOffset.value + containerSize.value + SCROLL_POSITION_TOLERANCE >=\n      scrollViewSize.value\n    );\n  }, []);\n\n  const distToTopEdge = useDerivedValue(() => {\n    return Math.max(0, hoverScreenOffset.value);\n  }, [hoverScreenOffset]);\n\n  const distToBottomEdge = useDerivedValue(() => {\n    const dist = containerSize.value - (hoverScreenOffset.value + activeCellSize.value)\n    return Math.max(0, dist);\n  }, [hoverScreenOffset, activeCellSize, containerSize]);\n\n  const isAtTopEdge = useDerivedValue(() => {\n    return distToTopEdge.value <= autoscrollThreshold;\n  }, []);\n\n  const isAtBottomEdge = useDerivedValue(() => {\n    return distToBottomEdge.value <= autoscrollThreshold;\n  });\n\n  const scrollTarget = useSharedValue(0);\n\n  useAnimatedReaction(\n    () => {\n      return isDraggingCell.value;\n    },\n    (cur, prev) => {\n      if (cur && !prev) {\n        scrollTarget.value = outerScrollOffset.value;\n      }\n    },\n    [activeCellSize]\n  );\n\n  function scrollToInternal(y: number) {\n    scrollableRef.current?.scrollTo({ y, animated: true });\n  }\n\n  useDerivedValue(() => {\n    const isAtEdge = isAtTopEdge.value || isAtBottomEdge.value;\n    const topDisabled = isAtTopEdge.value && isScrolledUp.value;\n    const bottomDisabled = isAtBottomEdge.value && isScrolledDown.value;\n    const isEdgeDisabled = topDisabled || bottomDisabled;\n\n    const scrollTargetDiff = Math.abs(scrollTarget.value - outerScrollOffset.value);\n    const scrollInProgress = scrollTargetDiff > SCROLL_POSITION_TOLERANCE;\n\n    const shouldScroll =\n      isAtEdge &&\n      !isEdgeDisabled &&\n      isDraggingCell.value &&\n      isTouchActiveNative.value &&\n      !scrollInProgress;\n\n    const distFromEdge = isAtTopEdge.value\n      ? distToTopEdge.value\n      : distToBottomEdge.value;\n    const speedPct = 1 - distFromEdge / autoscrollThreshold;\n    const offset = speedPct * autoscrollSpeed;\n    const targetOffset = isAtTopEdge.value\n      ? Math.max(0, outerScrollOffset.value - offset)\n      : outerScrollOffset.value + offset;\n    if (shouldScroll) {\n      scrollTarget.value = targetOffset;\n      // Reanimated scrollTo is crashing on android. use 'regular' scrollTo until figured out.\n      // scrollTo(scrollViewRef, 0, scrollTarget.value, true)\n      runOnJS(scrollToInternal)(targetOffset);\n    }\n  }, [autoscrollSpeed, autoscrollThreshold, isDraggingCell]);\n\n  return null;\n}\n"],"mappings":"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"}